<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<title>BETÜLÜME</title>
<link rel="icon" type="image/x-icon" href="rose_icon.ico">
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden;
    background-color: black;
    height: 100vh;
    width: 100vw;
    transition: background-color 4s ease;
  }
  #welcome {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-family: 'Courier New', monospace;
    font-size: 5rem;
    text-align: center;
    user-select: none;
    white-space: nowrap;
    transition: opacity 1s ease;
  }
  .letter {
    display: inline-block;
    opacity: 0;
    transform: translateY(-50px);
    animation: drop 0.5s forwards;
  }
  @keyframes drop {
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  #startImg {
    cursor: default;
    width: 600px;
    height: auto;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 10;
    transition: opacity 1.5s ease;
    opacity:0;
    pointer-events: none;
  }
  #startImg.visible {
  opacity: 1;
  pointer-events: auto;
  cursor: pointer;
  }

@keyframes gentle-spin {
  0%   { transform: translate(-50%, -50%) rotate(-20deg); }
  50%  { transform: translate(-50%, -50%) rotate(20deg); }
  100% { transform: translate(-50%, -50%) rotate(-20deg); }
}

.rotate {
  animation: gentle-spin 5s ease-in-out infinite;
}

@keyframes wind-move {
  0% {
    transform: translateX(-120vw) translateY(-20px);
    opacity: 0.7;
  }
  100% {
    transform: translateX(0) translateY(0);
    opacity: 0;
  }
}

@keyframes fadeOutWind {
  to { opacity: 0; }
}

.wind.fade-out {
  animation: fadeOutWind 1s ease forwards;
}

.wind {
  position: fixed;
  top: 30%;
  left: 100%;
  width: 200px;
  height: 3.2px;
  background: linear-gradient(90deg, rgba(255,255,255,0.2), rgba(255,255,255,0.7), rgba(255,255,255,0.2));
  opacity: 0.7;
  animation: wind-move 3.5s linear infinite;
  filter: drop-shadow(0 0 3px white);
  border-radius: 50%;
}

  .text-container {
    display: inline-block;
  }

  .line {
    white-space: nowrap;
  }

#loveNoteContainer {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  opacity: 0;
  display: none;
  transition: opacity 1s ease;
  z-index: 20;
}

#loveNote {
  font-size: 1.5rem;
  font-family: 'Georgia', serif;
  text-align: center;
  padding: 0.5rem 1rem;
  background-color: transparent;
  color: #aaa;
  font-style: italic;
  border: 2px solid #aaa;
  border-radius: 12px;
  outline: none;
  min-width: 300px;
  transition: all 0.3s ease;
}

#loveNote:focus {
  color: white;
  font-style: normal;
  border-color: white;
}

#sendBtn {
  background: transparent;
  border: 1px solid #aaa;
  color: #aaa;
  margin-left: 6px;
  padding: 6px 12px;
  font-size: 1.5rem;
  line-height: 2.2rem;
  cursor: pointer;
  border-radius: 12px;
  user-select: none;
  transition: color 0.3s, border-color 0.3s;
}

#sendBtn:hover {
  color: #ff4d00;
  border-color: #ff4d00;
}

</style>
</head>
<body>

<img id="startImg" class="rotate" src="orange_rose.png" alt="Başlat">
<audio id="windSound" src="wind_sound.mp3" preload="auto" autoplay loop muted></audio>
<audio id="peaceSound" src="peace_sound.mp3" preload="auto" autoplay loop muted></audio>
<div id="welcome"></div>
<div id="loveNoteContainer">
  <input type="text" id="loveNote" value="De ki 'Seni Seviyorum'" />
  <button id="sendBtn">→</button>
</div>

<script>
const welcome = document.getElementById("welcome");
const startImg = document.getElementById("startImg");
const windSound = document.getElementById('windSound');
const peaceSound = document.getElementById('peaceSound');
const windsContainer = document.body;
const windCount = 5;
const loveNoteContainer = document.getElementById('loveNoteContainer');
const loveNote = document.getElementById('loveNote');
const placeholderText = "De ki 'Seni Seviyorum'";
const sendBtn = document.getElementById('sendBtn');

function createWindLines() {
  for(let i = 0; i < windCount; i++) {
    const windDiv = document.createElement('div');
    windDiv.classList.add('wind');
    windDiv.style.top = `${20 + i * 15}%`;
    windDiv.style.animationDelay = `${i * 0.7}s`;
    windsContainer.appendChild(windDiv);
  }
}

function onFirstClick() {
  windSound.muted = false;
  windSound.volume = 0.4;
  windSound.play();

  if(document.querySelectorAll('.wind').length === 0) {
      createWindLines();
  }

  setTimeout(() => {
      startImg.classList.add('visible');
  }, 1500);
  document.removeEventListener('click', onFirstClick);
}

document.addEventListener('click', onFirstClick);

startImg.addEventListener("click", function() {
  this.style.opacity = 0;
  this.addEventListener('transitionend', () => {
    this.style.display = "none";
    start();
  }, { once: true });
});

function fadeIn(element) {
  element.style.display = 'block';
  setTimeout(() => {
    element.style.opacity = '1';
  }, 10);
}

function fadeOut(element, callback) {
  element.style.display = 'block';
  setTimeout(() => {
    element.style.opacity = '0';
  }, 10);

  element.addEventListener('transitionend', function handler(event) {
    if(event.propertyName === 'opacity') {
      element.removeEventListener('transitionend', handler);
      element.style.display = 'none';
      if (callback) callback();
    }
  });
}

function fadeOutText(element, callback) {
  element.style.opacity = 0;
  element.addEventListener('transitionend', function handler() {
    element.removeEventListener('transitionend', handler);
    if(callback) callback();
  });
}

loveNote.addEventListener('focus', () => {
  if (loveNote.value === placeholderText) {
    loveNote.value = '';
    loveNote.style.color = 'white';
    loveNote.style.fontStyle = 'normal';
  }
});

loveNote.addEventListener('blur', () => {
  if (loveNote.value.trim() === '') {
    loveNote.value = placeholderText;
    loveNote.style.color = '#aaa';
    loveNote.style.fontStyle = 'italic';
  }
});

loveNote.addEventListener('keydown', (e) => {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    submitLoveNote();
  }
});

function shake(element) {
  let count = 0;
  const interval = setInterval(() => {
    element.style.transform = (count % 2 === 0) ? 'translateX(-15px)' : 'translateX(15px)';
    count++;
    if (count > 5) {
      clearInterval(interval);
      element.style.transform = 'translateX(0)';
    }
  }, 50);
}

function submitLoveNote() {
  const text = loveNote.value.trim().toLowerCase();

  if (text === 'seni seviyorum') {
    fadeOut(loveNoteContainer);

    document.querySelectorAll('.wind').forEach(wind => {
      wind.classList.add('fade-out')
    });

    setTimeout(() => {
      document.body.style.backgroundColor = "white";

      let volume = windSound.volume;
      const fadeAudio = setInterval(() => {
        if (volume > 0.01) {
          volume -= 0.01;
          windSound.volume = volume;
        } else {
          clearInterval(fadeAudio);
          windSound.pause();
          windSound.currentTime = 0;
          peaceSound.muted = false;
          peaceSound.volume = 0.4;
          peaceSound.play();
        }
      }, 60);

      setTimeout(() => {
        const flowerCanvas = document.createElement('canvas');
        flowerCanvas.id = "canvas";
        document.body.appendChild(flowerCanvas);
        const ctx = flowerCanvas.getContext('2d');

        Object.assign(flowerCanvas.style, {
          position: "fixed",
          top: "0",
          left: "0",
          width: "100vw",
          height: "100vh",
          opacity: "0",
          backgroundColor: "white",
          transition: "opacity 3s ease",
          zIndex: "10"
        });

        setTimeout(() => {
          flowerCanvas.style.opacity = "1";
        }, 50);

        function resize() {
          flowerCanvas.width = window.innerWidth;
          flowerCanvas.height = window.innerHeight;
        }
        window.addEventListener('resize', resize);
        resize();

        function drawFlower(x, y, petalCount, petalRadius, centerRadius, color, rotation, opacity) {
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate(rotation);

          ctx.globalAlpha = opacity;

          for (let i = 0; i < petalCount; i++) {
            ctx.beginPath();
            ctx.fillStyle = color;
            ctx.ellipse(0, petalRadius, petalRadius / 2, petalRadius, 0, 0, 2 * Math.PI);
            ctx.fill();
            ctx.rotate((2 * Math.PI) / petalCount);
          }

          ctx.beginPath();
          ctx.fillStyle = 'yellow';
          ctx.arc(0, 0, centerRadius, 0, 2 * Math.PI);
          ctx.fill();

          ctx.restore();
          ctx.globalAlpha = 1;
        }

        const colors = [
          'rgba(255, 69, 0, 0.8)',
          'rgba(255, 140, 0, 0.8)',
          'rgba(255, 215, 0, 0.8)',
          'rgba(50, 205, 50, 0.8)',
          'rgba(30, 144, 255, 0.8)',
          'rgba(138, 43, 226, 0.8)',
          'rgba(255, 20, 147, 0.8)'
        ];

        const flowers = [];
        const flowersToShow = [];

        function randomRange(min, max) {
          return Math.random() * (max - min) + min;
        }

        function distance(x1, y1, x2, y2) {
          return Math.sqrt((x2 - x1) ** 2 + (y2 - y1) ** 2);
        }

        function isOverlapping(x, y, radius) {
          for (let f of flowers) {
            const minDist = radius + f.petalRadius + 50;
            if (distance(x, y, f.x, f.y) < minDist) {
              return true;
            }
          }
          return false;
        }

        function Flower() {
          this.petalCount = Math.floor(randomRange(5, 9));
          this.petalRadius = randomRange(20, 50);
          this.centerRadius = this.petalRadius / 3;

          let newColor;
          do {
            newColor = colors[Math.floor(Math.random() * colors.length)];
          } while (flowers.length > 0 && newColor === flowers[flowers.length - 1].color);

          this.color = newColor;
          this.rotation = Math.random() * Math.PI * 2;
          this.rotationSpeed = randomRange(0.005, 0.008);

          this.opacity = 0;

          let tries = 0;
          do {
            this.x = randomRange(this.petalRadius + 10, flowerCanvas.width - this.petalRadius - 10);
            this.y = randomRange(this.petalRadius + 10, flowerCanvas.height - this.petalRadius - 10);
            tries++;
            if (tries > 1000) break;
          } while (isOverlapping(this.x, this.y, this.petalRadius));
        }

        Flower.prototype.update = function () {
          this.rotation += this.rotationSpeed;

          if (this.opacity < 1) {
            this.opacity += 0.01;
            if (this.opacity > 1) this.opacity = 1;
          }
        };

        Flower.prototype.draw = function () {
          drawFlower(this.x, this.y, this.petalCount, this.petalRadius, this.centerRadius, this.color, this.rotation, this.opacity);
        };

        function tryAddFlower() {
          let tries = 0;
          while (tries < 1000) {
            const f = new Flower();
            if (!isOverlapping(f.x, f.y, f.petalRadius)) {
              flowers.push(f);
              return true;
            }
            tries++;
          }
          return false;
        }

        while (tryAddFlower()) { }

        let currentFlowerIndex = 0;
        const addFlowerInterval = setInterval(() => {
          if (currentFlowerIndex < flowers.length) {
            flowersToShow.push(flowers[currentFlowerIndex]);
            currentFlowerIndex++;
          } else {
            clearInterval(addFlowerInterval);
          }
        }, 1200);

        function animate() {
          ctx.clearRect(0, 0, flowerCanvas.width, flowerCanvas.height);
          ctx.fillStyle = 'white';
          ctx.fillRect(0, 0, flowerCanvas.width, flowerCanvas.height);

          flowersToShow.forEach(flower => {
            flower.update();
            flower.draw();
          });

          requestAnimationFrame(animate);
        }

        animate();
      }, 3000);

    }, 1000);
  } else {
    shake(loveNote);
  }
}
    

sendBtn.addEventListener('click', () => {
  submitLoveNote();
});

function showTextDropEffect(text, delayBetween, callback) {
  const lines = text.split('\n');
  const textContainer = document.createElement('div');
  textContainer.classList.add('text-container');

  let totalCharsBeforeLine = 0;

  lines.forEach((line) => {
    const lineDiv = document.createElement('div');
    lineDiv.style.whiteSpace = 'nowrap';
    lineDiv.classList.add('line');

    [...line].forEach((char, index) => {
      const span = document.createElement('span');
      span.classList.add('letter');
      span.innerHTML = char === ' ' ? '&nbsp;' : char;
      span.style.animationDelay = `${(totalCharsBeforeLine + index) * delayBetween}ms`;
      lineDiv.appendChild(span);
    });

    textContainer.appendChild(lineDiv);
    totalCharsBeforeLine += line.length;
  });

  welcome.appendChild(textContainer);

  const totalTime = totalCharsBeforeLine * delayBetween + 1000;
  setTimeout(() => {
    if (callback) callback(textContainer);
  }, totalTime);
}

function start() {
  const texts = [
    "Sesim rügzar gibi\nsert çıkmış olsa da,",
    "Kalbim her zaman\ntatlı bir meltem gibi\nfısıldamak ister sana.",
    "Seni Çok Seviyorum\nSevgilim"
  ];

  let index = 0;

  function showNextText() {
    if (index < texts.length) {
      showTextDropEffect(texts[index], 120, () => {
        setTimeout(() => {
          fadeOutText(welcome, () => {
            welcome.innerHTML = '';
            welcome.style.opacity = 1;
            index++;
            showNextText();
          });
        }, 900);
      });
    } else {
        welcome.style.display = 'none';
        fadeIn(loveNoteContainer);
    }
  }
  showNextText();
}

</script>
</body>
</html>
